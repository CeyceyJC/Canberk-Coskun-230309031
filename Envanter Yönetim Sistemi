//--PROTOTİP-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

public interface Storable {
    String toCSVRow();
}

//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

public class Supplier {
    private String id;
    private String name;
    private String phone;

    public Supplier(String id, String name, String phone) {
        this.id = id;
        this.name = name;
        this.phone = phone;
    }

    public String getid() {
        return id;
    }

    public String getName() {
        return name;
    }

    public void getPhone(String phone) {
        this.phone = phone;
    }

    public void setId(String id) {
        this.id = id; }

    public void setName(String name) {
        this.name = name; }

    public void setPhone(String phone) {
        this.phone = phone; }
}

    public String toCSVRow() {
        return mail + "," + name + "," + phone;
    }

    @Override
    public String toString() {
        return mail + " - " + name + " (" + phone + ")";
    }
}


//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

public abstract class Product {
    private String id;
    private String name;
    private double unitPrice;
    private int quantity;

    public Product(String id, String name, double unitPrice, int quantity) {
        this.id = id;
        this.name = name;
        this.unitPrice = unitPrice;
        this.quantity = quantity;
    }

    public abstract String getTypeCode();
    public String getExpiryDate() { return ""; }

    public String getId() { return id; }
    public String getName() { return name; }
    public double getUnitPrice() { return unitPrice; }
    public int getQuantity() { return quantity; }

    public void setName(String name) { this.name = name; }
    public void setUnitPrice(double unitPrice) { this.unitPrice = unitPrice; }
    public void setQuantity(int quantity) { this.quantity = quantity; }

    public void addStock(int amount) {
        quantity += amount;
    }

    public boolean reduceStock(int amount) {
        if (quantity >= amount) {
            quantity -= amount;
            return true;
        }
        return false;
    }

    public String stockWarning() {
        if (quantity < 5) return "!!! KRITIK STOK (5'ten az) !!!";
        if (quantity < 10) return "!! AZ STOK (10'dan az) !!";
        return "";
    }

    @Override
    public String toString() {
        String exp = getExpiryDate();
        String expText = exp.equals("") ? "" : (" | SKT: " + exp);
        String warn = stockWarning();
        String warnText = warn.equals("") ? "" : (" | " + warn);

        return getId() + " (" + getTypeCode() + ") - " + getName()
                + " | Fiyat: " + getUnitPrice()
                + " | Adet: " + getQuantity()
                + expText
                + warnText;
    }
}

//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

public class NormalProduct extends Product {

    public NormalProduct(String id, String name, double unitPrice, int quantity) {
        super(id, name, unitPrice, quantity);
    }

    @Override
    public String getTypeCode() {
        return "NP";
    }

    @Override
    public String toCSVRow() {
        return getId() + "," + getTypeCode() + "," + getName() + "," + getUnitPrice() + "," + getQuantity() + ",";
    }
}

//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

public class PerishableProduct extends Product {
    private String expiryDate;

    public PerishableProduct(String id, String name, double unitPrice, int quantity, String expiryDate) {
        super(id, name, unitPrice, quantity);
        this.expiryDate = expiryDate;
    }

    @Override
    public String getTypeCode() {
        return "PP";
    }

    @Override
    public String getExpiryDate() {
        return expiryDate;
    }

    public void setExpiryDate(String expiryDate) {
        this.expiryDate = expiryDate;
    }

    @Override
    public String toCSVRow() {
        return getId() + "," + getTypeCode() + "," + getName() + "," + getUnitPrice() + "," + getQuantity() + "," + expiryDate;
    }
}

//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

public class Order {
    private String date;
    private String type;
    private String productId;
    private String productName;
    private int quantity;
    private double unitPrice;
    private double total;
    private String supplierName;

    public Order(String date, String type, String productId, String productName,
                 int quantity, double unitPrice, String supplierName) {
        this.date = date;
        this.type = type;
        this.productId = productId;
        this.productName = productName;
        this.quantity = quantity;
        this.unitPrice = unitPrice;
        this.total = quantity * unitPrice;
        this.supplierName = supplierName;
    }

    public String getDate() { return date; }
    public String toCSVRow() {
        return date + "," + type + "," + productId + "," + productName + "," + quantity + "," + unitPrice + "," + total + "," + supplierName;
    }

    public void printReceipt() {
        System.out.println("\n==============================");
        System.out.println(type.equals("BUY") ? "         ALIS FISI" : "         SATIS FISI");
        System.out.println("------------------------------");
        System.out.println("Tarih       : " + date);
        System.out.println("Urun ID     : " + productId);
        System.out.println("Urun Adi    : " + productName);
        System.out.println("Adet        : " + quantity);
        System.out.println("Birim Fiyat : " + unitPrice);
        System.out.println("Toplam      : " + total);
        System.out.println("Tedarikci   : " + supplierName);
        System.out.println("==============================\n");
    }
}

//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileWriter;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Scanner;

public class Inventory {
    private ArrayList<Product> products = new ArrayList<>();

    public ArrayList<Product> getProducts() {
        return products;
    }

    public Product findById(String id) {
        for (Product p : products) {
            if (p.getId().equalsIgnoreCase(id)) return p;
        }
        return null;
    }

    public void addOrUpdate(Product newProduct) {
        Product existing = findById(newProduct.getId());
        if (existing != null) {
            existing.addStock(newProduct.getQuantity());
            // fiyatı güncel tutmak istersen:
            existing.setUnitPrice(newProduct.getUnitPrice());
        } else {
            products.add(newProduct);
        }
    }

    public boolean sell(String id, int qty) {
        Product p = findById(id);
        if (p == null) return false;
        return p.reduceStock(qty);
    }

    public boolean updateStock(String id, int newQty) {
        Product p = findById(id);
        if (p == null) return false;
        p.setQuantity(newQty);
        return true;
    }

    public void printInventory() {
        System.out.println("\n===== ENVANTER =====");
        if (products.size() == 0) {
            System.out.println("Envanter boş.");
            return;
        }
        for (Product p : products) {
            System.out.println(p);
        }
    }

    public void ensureInventoryFile(String fileName) {
        try {
            File f = new File(fileName);
            if (!f.exists()) {
                FileWriter w = new FileWriter(fileName);
                w.write("id,type,name,unitPrice,quantity,expiryDate\n");
                w.close();
            }
        } catch (IOException e) {
            System.out.println("inventory.csv olusturulamadi!");
        }
    }

    public void loadFromCSV(String fileName) {
        File f = new File(fileName);
        if (!f.exists()) return;

        try {
            Scanner reader = new Scanner(f);

            if (reader.hasNextLine()) reader.nextLine(); // header geç

            while (reader.hasNextLine()) {
                String line = reader.nextLine();
                if (line.trim().equals("")) continue;

                String[] parts = line.split(",");
                String id = parts[0];
                String type = parts[1];
                String name = parts[2];
                double unitPrice = Double.parseDouble(parts[3]);
                int qty = Integer.parseInt(parts[4]);
                String expiry = (parts.length >= 6) ? parts[5] : "";

                if (type.equalsIgnoreCase("PP")) {
                    products.add(new PerishableProduct(id, name, unitPrice, qty, expiry));
                } else {
                    products.add(new NormalProduct(id, name, unitPrice, qty));
                }
            }
            reader.close();

        } catch (FileNotFoundException e) {
            System.out.println("Envanter dosyasi bulunamadi!");
        }
    }

    public void saveToCSV(String fileName) {
        try {
            FileWriter w = new FileWriter(fileName, false);
            w.write("id,type,name,unitPrice,quantity,expiryDate\n");

            for (Product p : products) {
                w.write(p.toCSVRow() + "\n");
            }

            w.close();
        } catch (IOException e) {
            System.out.println("Envanter dosyasina yazilamadi!");
        }
    }
}

//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

import java.util.Scanner;

public class Employee {
    protected String username;
    private String password;

    public Employee(String username, String password) {
        this.username = username;
        this.password = password;
    }

    public boolean login(Scanner input) {
        System.out.print("Kullanici adi: ");
        String u = input.nextLine();
        System.out.print("Sifre: ");
        String p = input.nextLine();

        if (u.equals(username) && p.equals(password)) {
            System.out.println("Giris basarili.\n");
            return true;
        } else {
            System.out.println("Hatali giris!\n");
            return false;
        }
    }

    public void searchProduct(Inventory inventory, Scanner input) {
        System.out.print("Aranacak urun ID: ");
        String id = input.nextLine();

        Product p = inventory.findById(id);
        if (p == null) {
            System.out.println("Urun bulunamadi!");
        } else {
            System.out.println("Bulunan urun: " + p);
        }
    }
}

//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileWriter;
import java.io.IOException;
import java.time.LocalDate;
import java.util.ArrayList;
import java.util.Scanner;

public class StockManager extends Employee {
    private ArrayList<Supplier> suppliers = new ArrayList<>();

    public StockManager(String username, String password) {
        super(username, password);
    }

    public void ensureSuppliersFile(String fileName) {
        try {
            File f = new File(fileName);
            if (!f.exists()) {
                FileWriter w = new FileWriter(fileName);
                w.write("id,name,phone\n");
                w.close();
            }
        } catch (IOException e) {
            System.out.println("suppliers.csv olusturulamadi!");
        }
    }

    public void loadSuppliers(String fileName) {
        File f = new File(fileName);
        if (!f.exists()) return;

        try {
            Scanner reader = new Scanner(f);
            if (reader.hasNextLine()) reader.nextLine(); // header

            while (reader.hasNextLine()) {
                String line = reader.nextLine();
                if (line.trim().equals("")) continue;
                String[] p = line.split(",");
                suppliers.add(new Supplier(p[0], p[1], p[2]));
            }
            reader.close();
        } catch (FileNotFoundException e) {
            System.out.println("suppliers.csv bulunamadi!");
        }
    }

    public void saveSuppliers(String fileName) {
        try {
            FileWriter w = new FileWriter(fileName, false);
            w.write("id,name,phone\n");
            for (Supplier s : suppliers) {
                w.write(s.toCSVRow() + "\n");
            }
            w.close();
        } catch (IOException e) {
            System.out.println("Suppliers kaydedilemedi!");
        }
    }

    private Supplier findSupplierById(String id) {
        for (Supplier s : suppliers) {
            if (s.getMail().equalsIgnoreCase(id)) return s;
        }
        return null;
    }

    public void ensureOrdersFile(String fileName) {
        try {
            File f = new File(fileName);
            if (!f.exists()) {
                FileWriter w = new FileWriter(fileName);
                w.write("date,type,productId,name,quantity,unitPrice,total,supplier\n");
                w.close();
            }
        } catch (IOException e) {
            System.out.println("orders.csv olusturulamadi!");
        }
    }

    public void appendOrder(String fileName, Order o) {
        try {
            FileWriter w = new FileWriter(fileName, true);
            w.write(o.toCSVRow() + "\n");
            w.close();
        } catch (IOException e) {
            System.out.println("Fiş dosyasina yazilamadi!");
        }
    }

    public void viewReceiptsByDate(String ordersFile, Scanner input) {
        System.out.print("Tarih gir (YYYY-MM-DD): ");
        String date = input.nextLine();

        try {
            Scanner reader = new Scanner(new File(ordersFile));
            if (reader.hasNextLine()) reader.nextLine(); // header

            System.out.println("\n=== " + date + " TARIHLI FISLER ===");
            boolean found = false;

            while (reader.hasNextLine()) {
                String line = reader.nextLine();
                if (line.trim().equals("")) continue;

                String[] p = line.split(",");
                if (p[0].equals(date)) {
                    found = true;
                    System.out.println(line);
                }
            }

            if (!found) System.out.println("Bu tarihte fis bulunamadi.");

            reader.close();
        } catch (FileNotFoundException e) {
            System.out.println("orders.csv bulunamadi!");
        }
    }

    public void buyProduct(Inventory inventory, Scanner input, String ordersFile, String inventoryFile, String suppliersFile) {
        System.out.println("\n--- URUN ALIS (STOK ARTIRMA) ---");

        System.out.print("Urun tipi (1-NP / 2-PP): ");
        int t = input.nextInt();
        input.nextLine();

        System.out.print("Urun ID (NP........ / PP........): ");
        String id = input.nextLine();

        // basit prefix kontrol
        if (t == 1 && !id.startsWith("NP")) {
            System.out.println("Hata: Normal urun ID 'NP' ile baslamali!");
            return;
        }
        if (t == 2 && !id.startsWith("PP")) {
            System.out.println("Hata: Perishable urun ID 'PP' ile baslamali!");
            return;
        }

        System.out.print("Urun adi: ");
        String name = input.nextLine();

        System.out.print("Birim fiyat: ");
        double price = input.nextDouble();

        System.out.print("Alinan adet: ");
        int qty = input.nextInt();
        input.nextLine();

        String expiry = "";
        if (t == 2) {
            System.out.println("SKT sec (1-30 gun sonra otomatik / 2-manuel gir): ");
            int sktChoice = input.nextInt();
            input.nextLine();

            if (sktChoice == 1) {
                expiry = LocalDate.now().plusDays(30).toString();
            } else {
                System.out.print("Yil: ");
                int y = input.nextInt();
                System.out.print("Ay: ");
                int m = input.nextInt();
                System.out.print("Gun: ");
                int d = input.nextInt();
                input.nextLine();
                expiry = LocalDate.of(y, m, d).toString();
            }
        }

        System.out.print("Tedarikci ID: ");
        String supId = input.nextLine();

        Supplier sup = findSupplierById(supId);
        if (sup == null) {
            System.out.println("Tedarikci bulunamadi. Yeni tedarikci ekleyelim.");
            System.out.print("Tedarikci adi: ");
            String supName = input.nextLine();
            System.out.print("Telefon: ");
            String phone = input.nextLine();

            sup = new Supplier(supId, supName, phone);
            suppliers.add(sup);
            saveSuppliers(suppliersFile);
        }

        Product p;
        if (t == 2) p = new PerishableProduct(id, name, price, qty, expiry);
        else p = new NormalProduct(id, name, price, qty);

        inventory.addOrUpdate(p);
        inventory.saveToCSV(inventoryFile);

        String date = LocalDate.now().toString();
        Order o = new Order(date, "BUY", id, name, qty, price, sup.getName());
        o.printReceipt();
        appendOrder(ordersFile, o);

        Product updated = inventory.findById(id);
        if (updated != null && !updated.stockWarning().equals("")) {
            System.out.println("UYARI: " + updated.stockWarning());
        }
    }

    public void sellProduct(Inventory inventory, Scanner input, String ordersFile, String inventoryFile) {
        System.out.println("\n--- URUN SATIS (STOK AZALTMA) ---");

        System.out.print("Urun ID: ");
        String id = input.nextLine();

        Product p = inventory.findById(id);
        if (p == null) {
            System.out.println("Urun bulunamadi!");
            return;
        }

        System.out.print("Satilan adet: ");
        int qty = input.nextInt();
        input.nextLine();

        boolean ok = inventory.sell(id, qty);
        if (!ok) {
            System.out.println("Yetersiz stok!");
            return;
        }

        inventory.saveToCSV(inventoryFile);

        String date = LocalDate.now().toString();
        Order o = new Order(date, "SELL", p.getId(), p.getName(), qty, p.getUnitPrice(), "N/A");
        o.printReceipt();
        appendOrder(ordersFile, o);

        Product updated = inventory.findById(id);
        if (updated != null && !updated.stockWarning().equals("")) {
            System.out.println("UYARI: " + updated.stockWarning());
        }
    }

    public void updateStock(Inventory inventory, Scanner input, String inventoryFile) {
        System.out.println("\n--- STOK GUNCELLE ---");
        System.out.print("Urun ID: ");
        String id = input.nextLine();

        System.out.print("Yeni stok adedi: ");
        int newQty = input.nextInt();
        input.nextLine();

        boolean ok = inventory.updateStock(id, newQty);
        if (!ok) {
            System.out.println("Urun bulunamadi!");
            return;
        }

        inventory.saveToCSV(inventoryFile);

        Product updated = inventory.findById(id);
        if (updated != null && !updated.stockWarning().equals("")) {
            System.out.println("UYARI: " + updated.stockWarning());
        }
        System.out.println("Stok guncellendi.");
    }
}

//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

import java.util.Scanner;

public class Main {
    public static void main(String[] args) {
        Scanner input = new Scanner(System.in);

        String INVENTORY_FILE = "inventory.csv";
        String SUPPLIERS_FILE = "suppliers.csv";
        String ORDERS_FILE = "orders.csv";

        Inventory inventory = new Inventory();
        inventory.ensureInventoryFile(INVENTORY_FILE);
        inventory.loadFromCSV(INVENTORY_FILE);

        Employee emp = new Employee("employee", "0000");
        StockManager manager = new StockManager("manager", "1234");

        manager.ensureSuppliersFile(SUPPLIERS_FILE);
        manager.loadSuppliers(SUPPLIERS_FILE);

        manager.ensureOrdersFile(ORDERS_FILE);

        System.out.println("===== ENVANTER SISTEMI =====");
        System.out.println("1- Employee Giris");
        System.out.println("2- StockManager Giris");
        System.out.print("Secim: ");
        int role = input.nextInt();
        input.nextLine();

        boolean loggedIn = false;

        if (role == 1) loggedIn = emp.login(input);
        else if (role == 2) loggedIn = manager.login(input);
        else {
            System.out.println("Gecersiz secim!");
            input.close();
            return;
        }

        if (!loggedIn) {
            input.close();
            return;
        }

        int secim;

if (role == 1) {
            do {
                System.out.println("\n--- EMPLOYEE MENU ---");
                System.out.println("1- Urun Ara (ID)");
                System.out.println("2- Cikis");
                System.out.print("Secim: ");
                secim = input.nextInt();
                input.nextLine();

                switch (secim) {
                    case 1:
                        emp.searchProduct(inventory, input);
                        break;
                    case 2:
                        System.out.println("Cikis yapiliyor...");
                        break;
                    default:
                        System.out.println("Gecersiz secim!");
                }
            } while (secim != 2);
        }

        else {
            do {
                System.out.println("\n--- STOCK MANAGER MENU ---");
                System.out.println("1- Envanter Listele");
                System.out.println("2- Urun Ara (ID)");
                System.out.println("3- Urun Al (Alis Fisi + CSV)");
                System.out.println("4- Urun Sat (Satis Fisi + CSV)");
                System.out.println("5- Stok Guncelle");
                System.out.println("6- Fisleri Tarihe Gore Goruntule");
                System.out.println("7- Cikis");
                System.out.print("Secim: ");
                secim = input.nextInt();
                input.nextLine();

                switch (secim) {
                    case 1:
                        inventory.printInventory();
                        break;
                    case 2:
                        manager.searchProduct(inventory, input);
                        break;
                    case 3:
                        manager.buyProduct(inventory, input, ORDERS_FILE, INVENTORY_FILE, SUPPLIERS_FILE);
                        break;
                    case 4:
                        manager.sellProduct(inventory, input, ORDERS_FILE, INVENTORY_FILE);
                        break;
                    case 5:
                        manager.updateStock(inventory, input, INVENTORY_FILE);
                        break;
                    case 6:
                        manager.viewReceiptsByDate(ORDERS_FILE, input);
                        break;
                    case 7:
                        System.out.println("Cikis yapiliyor...");
                        break;
                    default:
                        System.out.println("Gecersiz secim!");
                }

            } while (secim != 7);
        }

        input.close();
    }
}

//--DÜZENLENMİŞ--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

public abstract class Product {
	private int productID;
	private int uniqueID;
	private float price;
	
	
	public Product(int productID, int uniqueID, float price) {
		this.productID = productID;
		this.uniqueID = uniqueID;
		this.price = price;
	}
	
	public int getProductID() {
		return productID;
	}
	
	public void setProductID(int productID) {
		this.productID = productID;
	}
	
	public int getUniqueID() {
		return uniqueID;
	}
	
	public void setUniqueID(int uniqueID) {
		this.uniqueID = uniqueID;
	}
	
	public float getPrice() {
		return price;
	}
	
	public void setPrice(float price) {
		this.price = price;
	}
	
	public abstract boolean isPerishable();
	public abstract boolean isExpired(int deadlineDay) throws ExpirationException;
}

//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
